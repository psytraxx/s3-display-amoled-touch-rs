import { HorizontalBox, VerticalBox, Button } from "std-widgets.slint";
import { Theme, Toggle, NavButton } from "common.slint";

export component AppWindow inherits Window {
    // Properties
    in-out property <int> battery-percentage: 0;
    in-out property <bool> charging: true;
    in-out property <string> pmu-details: "No data yet\n\nPress refresh in PMU Details screen";
    in-out property <string> radar-data: "Waiting for radar data...\n\nData updates automatically every 200ms";
    in-out property <int> current-screen: 0; // 0: Main, 1: PMU Details, 2: Radar

    // Callbacks
    callback toggle-charger(bool);
    callback request-pmu-update();

    width: 536px;
    height: 240px;
    default-font-size: Theme.font-size-standard;
    background: Theme.page-background-color;

    HorizontalLayout {
        padding: 0px;
        spacing: 0px;

        // Left Navigation Sidebar
        nav-sidebar := Rectangle {
            width: 100px;
            background: #F5F5F5;
            border-color: #E0E0E0;
            border-width: 1px;

            VerticalLayout {
                padding: 6px;
                spacing: 6px;
                alignment: start;

                NavButton {
                    label: "Main";
                    active: root.current-screen == 0;
                    clicked => {
                        root.current-screen = 0;
                    }
                }

                NavButton {
                    label: "PMU";
                    active: root.current-screen == 1;
                    clicked => {
                        root.current-screen = 1;
                    }
                }

                NavButton {
                    label: "Radar";
                    active: root.current-screen == 2;
                    clicked => {
                        root.current-screen = 2;
                    }
                }
            }
        }

        // Main content area
        content-area := Rectangle {
            width: parent.width - 100px;
            background: white;

            // Main Screen (Battery & Charger)
            if root.current-screen == 0: HorizontalLayout {
                padding: 10px;
                spacing: 15px;

                // Battery Percentage Display (Left Side)
                VerticalLayout {
                    width: 60%;
                    spacing: 5px;
                    alignment: center;

                    Text {
                        text: root.battery-percentage + "%";
                        font-size: Theme.font-size-huge;
                        font-weight: 900;
                        color: root.battery-percentage < 20 ? #F44336 : (root.battery-percentage < 50 ? #FF9800 : #4CAF50);
                        horizontal-alignment: center;
                    }

                    Text {
                        text: "Battery";
                        font-size: Theme.font-size-standard;
                        color: #666666;
                        horizontal-alignment: center;
                    }
                }

                // Charger Toggle Section (Right Side)
                VerticalLayout {
                    width: 40%;
                    spacing: 8px;
                    alignment: center;

                    Text {
                        text: "Charger";
                        font-size: Theme.font-size-standard;
                        color: #201f1e;
                        horizontal-alignment: center;
                    }

                    Toggle {
                        on: root.charging;
                        clicked => {
                            root.toggle-charger(!self.on);
                        }
                    }
                }
            }

            // PMU Details Screen
            if root.current-screen == 1: Rectangle {
                VerticalLayout {
                    padding: 8px;
                    spacing: 6px;

                    HorizontalLayout {
                        height: 50px;
                        alignment: start;

                        Text {
                            text: "PMU Details";
                            font-size: Theme.font-size-standard;
                            font-weight: 700;
                            color: #201f1e;
                            vertical-alignment: center;
                        }
                    }

                    Flickable {
                        height: parent.height - 56px;
                        interactive: true;
                        viewport-height: pmu-text.preferred-height;

                        pmu-text := Text {
                            text: root.pmu-details;
                            font-size: Theme.font-size-small;
                            width: parent.viewport-width;
                            wrap: word-wrap;
                            color: #201f1e;
                        }
                    }
                }

                // Floating refresh button (bottom right)
                Button {
                    text: "â†»";
                    primary: true;
                    width: 60px;
                    height: 60px;
                    x: parent.width - self.width - 12px;
                    y: parent.height - self.height - 12px;
                    clicked => {
                        root.request-pmu-update();
                    }
                }
            }

            // Radar Screen
            if root.current-screen == 2: VerticalLayout {
                padding: 8px;
                spacing: 6px;

                HorizontalLayout {
                    height: 50px;
                    alignment: start;

                    Text {
                        text: "Radar Data (Live)";
                        font-size: Theme.font-size-standard;
                        font-weight: 700;
                        color: #201f1e;
                        vertical-alignment: center;
                    }
                }

                Flickable {
                    height: parent.height - 56px;
                    interactive: true;
                    viewport-height: radar-text.preferred-height;

                    radar-text := Text {
                        text: root.radar-data;
                        font-size: Theme.font-size-small;
                        width: parent.viewport-width;
                        wrap: word-wrap;
                        color: #201f1e;
                    }
                }
            }
        }
    }
}
